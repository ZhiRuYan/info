"use strict";angular.module("infoApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){d.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",d.defaults.withCredentials=!0,a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("about",{url:"/about.html",templateUrl:"views/about.html",controller:"AboutCtrl"}).state("login",{url:"/login.html",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("register",{url:"/register.html",templateUrl:"views/register.html",controller:"RegisterCtrl"}).state("layout",{url:"/layout",templateUrl:"views/layout.html",controller:"LayoutCtrl"}).state("layout.myinfo",{url:"/myinfo.html",templateUrl:"views/myinfo.html",controller:"MyinfoCtrl"}).state("layout.maintain",{url:"/maintain.html",templateUrl:"views/maintain.html",controller:"MaintainCtrl"}),b.otherwise("/")}]),angular.module("infoApp").controller("MainCtrl",["$scope","config","dataservice",function(a,b,c){c.testApi().then(function(b){a.test=b.data.testData})}]),angular.module("infoApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("infoApp").service("dataservice",["$http","config",function(a,b){var c=function(a){return b.apiRoot+"api/"+a};this.testApi=function(){return a.post(c("main"))},this.register=function(b){return a.post(c("register"),b)},this.tryLogin=function(b){return a.post(c("tryLogin"),b)},this.logout=function(){return a.post(c("logout"))},this.initPage=function(){return a.post(c("initPage"))}}]),angular.module("infoApp").constant("config",function(){var a="dev",b={dev:{apiRoot:"http://127.0.0.1:3000/"},prod:{apiRoot:""}};return b[a]}()),angular.module("infoApp").controller("LoginCtrl",["$scope","dataservice","$location","uiService","$state",function(a,b,c,d,e){a.loginInfo={user:"",password:""},a.passCheck=!1,a.loginState="登录",a.wrongInfo="";var f=a.loginInfo;a.tryLogin=function(){$(".loginForm").removeClass("shake zoomInDown"),b.tryLogin(f).then(function(b){a.wrongInfo=b.data.result,"登录成功"==b.data.result?e.go("layout"):(d.showError("密码错误，请重新输入"),$(".loginForm").addClass("shake"))})["catch"](function(a){console.log(a)})},a.toRegister=function(){e.go("register")}}]),angular.module("infoApp").controller("RegisterCtrl",["$scope","dataservice","$location","uiService","$state",function(a,b,c,d,e){a.user={username:"",email:"",pass:"",passRepeat:""},a.addUser=function(){$(".sign-up").removeClass("shake zoomInUp"),b.register(a.user).then(function(a){"用户已存在"==a.data.result?(d.showError("用户已存在"),$(".sign-up").addClass("shake")):"操作成功"==a.data.result?(d.showSuccess("操作成功"),e.go("login")):d.showWarning("系统错误")})["catch"](function(a){console.log(a)})},a.toLogin=function(){c.path("login.html")},a.isExist=!1}]),angular.module("infoApp").controller("LayoutCtrl",["$scope","dataservice","$location","$state",function(a,b,c,d){a.logout=function(){b.logout().then(function(a){"退出成功"==a.data.state&&d.go("login")})},a.changeState=function(a){switch(a){case 1:d.go("layout.myinfo");break;case 2:d.go("layout.maintain");break;case 3:d.go("layout.myinfo");break;default:d.go("layout.myinfo")}},b.initPage().then(function(b){a.username=b.data})}]),angular.module("infoApp").service("uiService",["$window",function(a){toastr.options={closeButton:!1,debug:!1,progressBar:!0,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"2000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},this.showError=function(a){toastr.error(a)},this.showInfo=function(a){toastr.info(a)},this.showSuccess=function(a){toastr.success(a)},this.showWarning=function(a){toastr.warning(a)},this.bootbox=bootbox,this.bootbox.setLocale("zh_CN")}]),angular.module("infoApp").controller("MyinfoCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("infoApp").controller("MaintainCtrl",["$scope","dataservice","$location","uiService","$state","$uibModal",function(a,b,c,d,e,f){a.createGroup=function(){},a.dissolution=function(){d.bootbox.confirm("确定解散该分组?",function(a){a&&console.log(a)})},a.createTask=function(){var a=f.open({templateUrl:"views/newtask.html",controller:"NewtaskCtrl",size:"md",resolve:{}});a.result.then(function(){d.showSuccess("投票创建成功")})}}]),angular.module("infoApp").controller("NewtaskCtrl",["$scope","$uibModalInstance","uiService",function(a,b,c){a.actions={submit:function(){},cancel:function(){b.dismiss("cancel")}}}]),angular.module("infoApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/layout.html",'<section class="layout-main"> <div class="user-info"> <div class="userInfo-basic"> <p class="userInfoBasic-p">欢迎回来 {{username}}</p> </div> <div class="userInfoBasic-button"> <button class="btn btn-primary" ng-click="logout()">退出登录</button> </div> </div> <div style="width: 100%;height: 65px"></div> <div class="layout-nav"> <ul class="layoutNav-ul"> <li class="layoutNav-li" ng-click="changeState(1)"> <a href="javascript:void(0)"><i class="fa fa-paper-plane layoutNav-i"></i>待办事项</a> </li> <li class="layoutNav-li" ng-click="changeState(2)"> <a href="javascript:void(0)"><i class="fa fa-wrench layoutNav-i"></i>管理群组</a> </li> <li class="layoutNav-li" ng-click="changeState(3)"> <a href="javascript:void(0)"><i class="fa fa-user layoutNav-i"></i>个人信息</a> </li> </ul> </div> <div class="layout-content"> <div ui-view></div> </div> <div class="layout-footer"> <div class="layout-footer-inner">技术支持:</div> </div> </section>'),a.put("views/login.html",'<section class="login-section"> <form name="loginForm" class="loginForm animated zoomInDown" novalidate> <div class="form-group"> <label for="user">用户名</label> <input type="text" name="user" id="user" class="form-control" ng-model="loginInfo.user" placeholder="请输入您的用户名" required> </div> <div class="form-group"> <label for="password">密码</label> <input type="password" name="password" id="password" class="form-control" ng-model="loginInfo.password" placeholder="请输入您的密码" required> </div> <button type="submit" class="btn btn-primary loginForm-button" ng-click="tryLogin()" ng-disabled="loginForm.$invalid">{{loginState}}</button> <button class="btn btn-success signIn-button" ng-click="toRegister()">注册</button> <span ng-show="passCheck" class="help-block loginForm-warning">{{wrongInfo}}</span> </form> </section>'),a.put("views/main.html",'<section class="html-main"> 首页 <ul> <li><a ui-sref="register">注册</a></li> <li><a ui-sref="login">登录</a></li> <li>关于</li> </ul> {{test}} {{con}} </section>'),a.put("views/maintain.html",'<section class="maintain-section col-md-12"> <div class="maintain-main"> <div class="maintain-top"> <div class="maintain-title"> <i class="fa fa-gears"></i> <span class="maintain-title-span">管理群组</span> </div> <div class="maintain-button"> <button class="btn btn-success" ng-click="createGroup()"> <i class="fa fa-plus"></i> 新建群组 </button> </div> </div> <div> <div class=""> <table class="table table-bordered"> <thead> <tr> <th width="30" class="maintain-th">组群ID</th> <th width="30" class="maintain-th">组群昵称</th> <th width="30" class="maintain-th">创建者</th> <th width="60" class="maintain-th">组群描述</th> </tr> </thead> <tbody> <tr> <td class="maintain-td"> 0000000000000000 </td> <td class="maintain-td"> 11111111111111 </td> <td class="maintain-td"> 22222222222 </td> <td class="maintain-td"> 3333333333 </td> </tr> <tr ng-repeat-end> <td class="text-right" colspan="6"> <button class="btn default btn-xs purple-stripe" ng-click="createTask()"> <i class="fa fa-edit"></i> 新建任务 </button> <button class="btn default btn-xs purple-stripe" ng-click=""> <i class="fa fa-edit"></i> 任务列表 </button> <button class="btn default btn-xs purple-stripe" ng-click=""> <i class="fa fa-edit"></i> 修改 </button> <button class="btn default btn-xs purple-stripe" ng-click="dissolution()"> <i class="fa fa-trash-o"></i> 解散 </button> <button class="btn default btn-xs purple-stripe" ng-click=""> <i class="fa fa-close"></i> 退出 </button> </td> </tr></tbody> </table> </div> </div> </div> </section>'),a.put("views/myinfo.html","myinfo"),a.put("views/newtask.html",'<div class="modal-header"> <button type="button" class="close" ng-click="actions.cancel()"></button> <h4 class="modal-title">{{entity.vote_id? \'修改\' : \'创建\'}}{{entity.type == 1 ? \'班徽\' : \'口号\'}}投票选项</h4> </div> <div class="modal-body"> <form name="form"> <form-body> <div class="row"> <div class="col-md-8"> <label class="control-label">主标题</label> <input class="form-control" ng-model="entity.title" placeholder="请输入主标题" validator="[required]" validator-group="v1"> </div> <div class="col-md-8"> <label class="control-label">副标题</label> <input class="form-control" ng-model="entity.sub_title" placeholder="请输入副标题" validator="[required]" validator-group="v1"> </div> <div class="col-md-8"> <label class="control-label">最多投几项</label> <input class="form-control" ng-model="entity.max_vote_count" placeholder="请输入最多投几项" validator="[required]" validator-group="v1"> </div> </div> </form-body> </form> </div> <div class="modal-footer"> <button class="btn green" type="button" ng-click="actions.submit()">确定 </button> <button class="btn default" type="button" ng-click="actions.cancel()">取消</button> </div>'),a.put("views/register.html",'<section class="register-section"> <div class="sign-up animated zoomInUp"> <form name="signUp" novalidate> <div class="form-group" ng-class="{ \'has-error\' : signUp.username.$invalid && !signUp.username.$pristine }"> <label for="username">用户名</label> <input type="text" name="username" id="username" class="form-control" ng-model="user.username" ng-minlength="3" ng-maxlength="15" placeholder="请输入您的用户名" required> <span ng-show="signUp.username.$dirty&&signUp.username.$error.required" class="help-block">*必填</span> <span ng-show="signUp.username.$error.minlength" class="help-block">*用户名太短</span> <span ng-show="signUp.username.$error.maxlength" class="help-block">*用户名太长</span> <span ng-show="signUp.username.isExist" class="help-block">*该用户已存在</span> </div> <div class="form-group" ng-class="{ \'has-error\' : signUp.email.$invalid && !signUp.email.$pristine }"> <label for="email">邮箱</label> <input type="email" name="email" id="email" class="form-control" ng-model="user.email" placeholder="请输入您的邮箱" required> <span ng-show="signUp.email.$dirty&&signUp.email.$error.required" class="help-block">*请输入合法的邮箱</span> </div> <div class="form-group" ng-class="{\'has-error\' : signUp.pass.$invalid && !signUp.pass.$pristine}"> <label for="pass">密码</label> <input type="password" name="pass" id="pass" class="form-control" ng-model="user.pass" placeholder="请设置您的密码" ng-minlength="6" ng-maxlength="20" required> <span ng-show="signUp.pass.$invalid&&signUp.pass.$error.minlength" class="help-block">*密码长度过短</span> <span ng-show="signUp.pass.$invalid&&signUp.pass.$error.maxlength" class="help-block">*密码长度过长</span> </div> <div class="form-group" ng-class="{\'has-error\' : (user.pass!=user.passRepeat) && !signUp.passRepeat.$pristine}"> <label for="pass">再次输入密码</label> <input type="password" name="passRepeat" id="passRepeat" class="form-control" ng-model="user.passRepeat" placeholder="请再输一遍密码" required> <span ng-show="(user.pass!=user.passRepeat)&&!signUp.passRepeat.$pristine" class="help-block">*两次输入密码不一致</span> </div> <button type="submit" class="btn btn-primary signUp-submit" ng-disabled="signUp.$invalid||(user.pass!=user.passRepeat)" ng-click="addUser()">注册</button> <button class="btn btn-success signUp-login" ng-click="toLogin()">登录</button> </form> </div> </section>')}]);